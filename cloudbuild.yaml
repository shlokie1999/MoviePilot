steps:
  # Install phase
  - name: 'ubuntu'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        echo "in the install phase"
        apt-get update && apt-get -y install jq
        apt-get install -y wget
        apt-get install -y maven
  # Pre-build phase: Instead of installing Nuclei via Go, pull and use the Docker image
  - name: 'docker'
    args: ['pull', 'projectdiscovery/nuclei']
  # Clone nuclei-templates
  - name: 'gcr.io/cloud-builders/git'
    args: ['clone', 'https://github.com/projectdiscovery/nuclei-templates.git']
  
  # Run nuclei scan using the Docker image
  - name: 'docker'
    args: 
      - 'run'
      - '--rm'
      - '-v'
      - '$PWD/nuclei-templates:/app/nuclei-templates'
      - 'projectdiscovery/nuclei'
      - '-u'
      - 'https://localhost:8000'
      - '-t'
      - '/app/nuclei-templates/'
      - '-o'
      - 'scan_report.txt'
      
artifacts:
  objects:
    location: 'gs://nuclei-scan-reports/'  # Update this with your bucket name
    paths: ['scan_report.txt']


      
